 /*
 * AutoSuggest
 * Copyright 2009-2010 Drew Wilson
 * www.drewwilson.com
 * code.drewwilson.com/entry/autosuggest-jquery-plugin
 *
 * Version 1.4.2   -   Updated: Oct. 31, 2014
 *
 * This Plug-In will auto-complete or auto-suggest completed search queries
 * for you as you type. You can add multiple selections and remove them on
 * the fly. It supports keybord navigation (UP + DOWN + RETURN), as well
 * as multiple AutoSuggest fields on the same page.
 *
 * Inspired by the Autocomplete plugin by: Jšrn Zaefferer
 * and the Facelist plugin by: Ian Tearle (iantearle.com)
 *
 * This AutoSuggest jQuery plug-in is dual licensed under the MIT and GPL licenses:
 *   http://www.opensource.org/licenses/mit-license.php
 *   http://www.gnu.org/licenses/gpl.html
 */
 (function(e){function t(e){return e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}e.fn.autoSuggest=function(n,r){var i={asHtmlID:false,startText:"Enter Name Here",emptyText:"No Results Found",preFill:{},limitText:"No More Selections Are Allowed",selectedItemProp:"value",selectedValuesProp:"value",searchObjProps:"value",queryParam:"q",retrieveLimit:false,extraParams:"",matchCase:false,minChars:1,keyDelay:400,resultsHighlight:true,neverSubmit:false,selectionLimit:false,selectFirstDataItem:false,blurOnComplete:false,showResultList:true,start:function(){},selectionClick:function(e){},selectionAdded:function(e){},selectionRemoved:function(e){e.remove()},formatList:false,beforeRetrieve:function(e){return e},retrieveComplete:function(e){return e},resultClick:function(e){},resultsComplete:function(){}};var s=e.extend(i,r);var o="object";var u=0;if(typeof n=="string"){o="string";var a=n}else{var f=n;for(var l in n)if(n.hasOwnProperty(l))u++}if(o=="object"&&u>0||o=="string"){return this.each(function(n){function L(){if(lastKeyPressCode==46||lastKeyPressCode>8&&lastKeyPressCode<32){return p.hide()}var t=i.val().replace(/[\\]+|[\/]+/g,"");if(t==N)return;N=t;if(t.length>=s.minChars){c.addClass("loading");if(o=="string"){var n="";if(s.retrieveLimit){n="&limit="+encodeURIComponent(s.retrieveLimit)}if(s.beforeRetrieve){t=s.beforeRetrieve.call(this,t)}e.getJSON(a+"?"+s.queryParam+"="+encodeURIComponent(t)+n+s.extraParams,function(e){u=0;var n=s.retrieveComplete.call(this,e);for(var r in n)if(n.hasOwnProperty(r))u++;O(n,t)})}else{if(s.beforeRetrieve){t=s.beforeRetrieve.call(this,t)}O(f,t)}}else{c.removeClass("loading");p.hide()}}function O(n,r){if(!s.matchCase){r=r.toLowerCase()}var o=0;p.html(d.html("")).hide();for(var a=0;a<u;a++){var f=a;A++;var h=false;var m;if(s.searchObjProps=="value"){m=n[f].value}else{m="";var g=s.searchObjProps.split(",");for(var y=0;y<g.length;y++){var b=e.trim(g[y]);m=m+n[f][b]+" "}}if(m){if(!s.matchCase){m=m.toLowerCase()}if(m.search(t(r))!=-1&&v.val().search(t("(^|,)"+n[f][s.selectedValuesProp]+"(,|$)"))==-1){h=true}}if(h){var w=e('<li class="as-result-item" id="as-result-item-'+f+'"></li>').click(function(){var t=e(this).data("data");var n=t.num;if(e("#as-selection-"+n,c).length<=0&&!k){var r=t.attributes;i.val("").focus();N="";M(r,n);s.resultClick.call(this,t);p.hide()}k=false}).mousedown(function(){l=false}).mouseover(function(){e("li",d).removeClass("active");e(this).addClass("active")}).data("data",{attributes:n[f],num:A});var E=e.extend({},n[f]);var S;if(!s.matchCase){S=new RegExp("(?![^&;]+;)(?!<[^<>]*)("+t(r)+")(?![^<>]*>)(?![^&;]+;)","gi")}else{S=new RegExp("(?![^&;]+;)(?!<[^<>]*)("+t(r)+")(?![^<>]*>)(?![^&;]+;)","g")}if(s.resultsHighlight){E[s.selectedItemProp]=E[s.selectedItemProp].replace(S,"<em>$1</em>")}if(!s.formatList){w=w.html(E[s.selectedItemProp])}else{w=s.formatList.call(this,E,w)}d.append(w);o++;if(s.retrieveLimit&&s.retrieveLimit==o){break}}}c.removeClass("loading");if(o<=0){d.html('<li class="as-message">'+s.emptyText+"</li>")}d.css("width",c.outerWidth());p.show();if(s.selectFirstDataItem){D()}s.resultsComplete.call(this)}function M(t,n){v.val(v.val()+t[s.selectedValuesProp]+",").trigger("change");var r=e('<li class="as-selection-item" id="as-selection-'+n+'"></li>').click(function(){s.selectionClick.call(this,e(this));c.children().removeClass("selected");e(this).addClass("selected")}).mousedown(function(){l=false});var o=e('<a class="as-close">&times;</a>').click(function(){v.val(v.val().replace(t[s.selectedValuesProp]+",","")).trigger("change");s.selectionRemoved.call(this,r);l=true;i.focus();return false});h.before(r.html(t[s.selectedItemProp]).prepend(o));var u=false;if(s.blurOnComplete&&s.selectionLimit&&e("li.as-selection-item",c).length==s.selectionLimit){u=true}s.selectionAdded.call(this,h.prev());if(u){i.trigger("blur")}}function _(t){if(e(":visible",p).length>0){var n=e("li",p);var r;if(t=="down"){r=n.eq(0)}else{r=n.filter(":last")}var i=e("li.active:first",p);if(i.length>0){if(t=="down"){r=i.next()}else{r=i.prev()}}n.removeClass("active");r.addClass("active")}}function D(){if(e(":visible",p).length>0){var t=e("li",p);var n=t.eq(0);var r=e("li.active:first",p);if(r.length>0){n=r.next()}t.removeClass("active");n.addClass("active")}}var r;if(!s.asHtmlID){n=n+""+Math.floor(Math.random()*100);r="as-input-"+n}else{n=s.asHtmlID;r=n}s.start.call(this);var i=e(this);i.attr("autocomplete","off").addClass("as-input").attr("id",r).val(s.startText);var l=false;i.wrap('<ul class="as-selections" id="as-selections-'+n+'"></ul>').wrap('<li class="as-original" id="as-original-'+n+'"></li>');var c=e("#as-selections-"+n);var h=e("#as-original-"+n);var p=e('<div class="as-results" id="as-results-'+n+'"></div>').hide();var d=e('<ul class="as-list"></ul>');var v=e('<input type="hidden" class="as-values" name="as_values_'+n+'" id="as-values-'+n+'" />');var m="";var g;if(typeof s.preFill=="string"){var y=s.preFill.split(",");for(g=0;g<y.length;g++){var b={};b[s.selectedValuesProp]=y[g];if(y[g]!==""){M(b,"000"+g)}}m=s.preFill}else{m="";var w=0;for(var E in s.preFill)if(s.preFill.hasOwnProperty(E))w++;if(w>0){for(g=0;g<w;g++){var S=s.preFill[g][s.selectedValuesProp];if(S===undefined){S=""}m=m+S+",";if(S!==""){M(s.preFill[g],"000"+g)}}}}if(m!==""){i.val("");var x=m.substring(m.length-1);if(x!=","){m=m+","}v.val(","+m).trigger("change");e("li.as-selection-item",c).addClass("blur").removeClass("selected")}i.after(v);c.click(function(){l=true;i.focus()}).mousedown(function(){l=false}).after(p);var T=null;var N="";var C=0;var k=false;i.focus(function(){if(e(this).val()==s.startText&&v.val()===""){e(this).val("")}else if(l){e("li.as-selection-item",c).removeClass("blur");if(e(this).val()!==""){d.css("width",c.outerWidth());p.show()}}l=true;return true}).blur(function(){if(e(this).val()===""&&v.val()===""&&m===""){e(this).val(s.startText)}else if(l){e("li.as-selection-item",c).addClass("blur").removeClass("selected");p.hide()}}).keydown(function(n){lastKeyPressCode=n.keyCode;first_focus=false;switch(n.keyCode){case 38:n.preventDefault();_("up");break;case 40:n.preventDefault();_("down");break;case 8:if(i.val()===""){var r=v.val().split(",");r=r[r.length-2];c.children().not(h.prev()).removeClass("selected");if(h.prev().hasClass("selected")){var o=new RegExp("(^|,)"+t(r)+"(,|$)");v.val(v.val().replace(o,",")).trigger("change");s.selectionRemoved.call(this,h.prev())}else{s.selectionClick.call(this,h.prev());h.prev().addClass("selected")}}if(i.val().length==1){p.hide();N=""}if(e(":visible",p).length>0){if(T){clearTimeout(T)}T=setTimeout(function(){L()},s.keyDelay)}break;case 9:case 188:k=true;var u=i.val().replace(/(,)/g,"").trim();if(u!==""&&v.val().search(new RegExp("(^|,)"+t(u)+"(,|$)"))<0&&u.length>=s.minChars){n.preventDefault();var a={};a[s.selectedItemProp]=u;a[s.selectedValuesProp]=u;var f=e("li",c).length;M(a,"00"+(f+1));i.val("")}break;case 13:k=false;var l=e("li.active:first",p);if(l.length>0){l.click();p.hide()}if(s.neverSubmit||l.length>0){n.preventDefault()}break;default:if(s.showResultList){if(s.selectionLimit&&e("li.as-selection-item",c).length>=s.selectionLimit){d.html('<li class="as-message">'+s.limitText+"</li>");p.show()}else{if(T){clearTimeout(T)}T=setTimeout(function(){L()},s.keyDelay)}}break}});var A=0})}}})(jQuery)